

<div class="custom-loader-overlay" *ngIf="isLoading">
  <div class="custom-spinner"></div>
  <div class="loading-text"></div>
</div>

<div class="export-heading">
  <mat-card class="export-card">
    <h3 class="export-title">REPORTS</h3>

  </mat-card>
</div>

<div class="reports-tabs-padding">
  <nav class="reports-tabs">
    <div class="button-padding">
      <button *ngFor="let tab of tabs" 
       class="tab" 
       [class.active]="tab.type === activeType" (click)="selectTab(tab)"
        type="button" 
        [attr.aria-pressed]="tab.type === activeType" 
        title="{{ tab.label }} (type: {{ tab.type }})"
        [disabled]="isLoading" 
        >
        {{ tab.label }}
      </button>
    </div>
  </nav>
</div>

<!-- selected item, search and custom search button -->
<mat-card class="button-card">

  <div class="button-row">

    <!-- <mat-form-field appearance="outline"> -->
    <div *ngIf="userRole !== '40' && userRole !== '50'" mat-stroked-button class="selected-item button-width">
      <mat-select #branchSelect multiple (selectionChange)="onSelectChange($event)"
        [panelClass]="'branch-select-panel'">



        <input type="text" class="custom-search-input" placeholder="Search Branch" [(ngModel)]="customSearchText"
          (input)="onCustomSearch()" />


        <mat-option (click)="$event.stopPropagation(); toggleAllSelection()">
          {{ isAllSelected() ? 'Deselect All Branches' : 'Select All Branches' }}
        </mat-option>

        <mat-select-trigger>
          {{ selectedCount }} items selected
        </mat-select-trigger>

        <mat-option *ngFor="let b of branchList" [value]="b" [attr.title]="b.code + ' - ' + b.name">
          {{ b.code }} - {{ b.name }}
        </mat-option>

      </mat-select>
    </div>


    <button mat-raised-button class="search-button" *ngIf="userRole !== '40' && userRole !== '50'" (click)="onSearchClick()">
      Search
    </button>



    <input type="text" class="custom-search-input" placeholder="Custom Search" [(ngModel)]="reportCustomSearchText"
      (input)="reportCustomSearch()" />



  </div>

  <div class="table-css">
    <!-- Table for branch summary -->
    <table class="table table-striped table-bordered text-center" *ngIf="activeType === 'A'">
      <thead class="column-css">

        <tr>
          <th>Branch Code</th>
          <th>Branch Name</th>
          <th>Pending New Records</th>
          <th>Pending for Approval</th>
          <th>CKYC Processing</th>
          <th>Batch Generated</th>
          <th>Awaiting CKYC Number</th>
          <th>CKYC Number Assigned</th>
          <th>Failed Record</th>
          <th>Deleted CIF</th>
        </tr>
      </thead>
      <tbody *ngIf="tableData && tableData.length > 0">
        <tr *ngFor="let item of tableData; let i = index; trackBy: trackByFn">
          <td>{{ item.branchCode || '-' }}</td>
          <td>{{ item.branchName || '-' }}</td>
          <td>{{ item.pendingNewRecords || '-' }}</td>
          <td>{{ item.pendingForApproval || '-' }}</td>
          <td>{{ item.ckycProcessing || '-' }}</td>
          <td>{{ item.batchGenerated || '-' }}</td>
          <td>{{ item.awaitingCkycNumber || '-' }}</td>
          <td>{{ item.ckycNumberAssigned || '-' }}</td>
          <td>{{ item.failedRecord || '-' }}</td>
          <td>{{ item.deletedCif || '-' }}</td>
        </tr>
      </tbody>
    </table>

    <!-- Table for Progressive Summary -->
    <table class="table table-striped table-bordered text-center" *ngIf="activeType === 'C'">
      <thead class="column-css">

        <tr>
          <th>Branch Code</th>
          <th>Approved Count T1</th>
          <th>Aprroved Count T2</th>

        </tr>
      </thead>
      <tbody *ngIf="tableData && tableData.length > 0">
        <tr *ngFor="let item of tableData; let i = index; trackBy: trackByFn">
          <td>{{ item.branch || '-' }}</td>
          <td>{{ item.t1ApprovedCount || '-' }}</td>
          <td>{{ item.t2ApprovedCount || '-' }}</td>

        </tr>
      </tbody>
    </table>
    <!-- Table For Deleted CIF -->
    <table class="table table-striped table-bordered text-center" *ngIf="activeType === 'E'">
      <thead class="column-css">

        <tr>
          <th>Branch Id</th>
          <th>Customer Id</th>
          <th>Full Name</th>

        </tr>
      </thead>
      <tbody *ngIf="tableData && tableData.length > 0">
        <tr *ngFor="let item of tableData; let i = index; trackBy: trackByFn">
          <td>{{ item.branchId || '-' }}</td>
          <td>{{ item.customerId || '-' }}</td>
          <td>{{ item.fullName || '-' }}</td>

        </tr>
      </tbody>
    </table>
    <!-- Table for restored CIF -->
    <table class="table table-striped table-bordered text-center" *ngIf="activeType === 'G'">
      <thead class="column-css">

        <tr>
          <th>Branch Id</th>
          <th>Customer Id</th>
          <th>Restored On</th>
          <th>Updated By</th>

        </tr>
      </thead>
      <tbody *ngIf="tableData && tableData.length > 0">
        <tr *ngFor="let item of tableData; let i = index; trackBy: trackByFn">
          <td>{{ item.branchId || '-' }}</td>
          <td>{{ item.customerId || '-' }}</td>
          <td>{{ item.restoredOn || '-' }}</td>
          <td>{{ item.updatedBy || '-' }}</td>

        </tr>
      </tbody>
    </table>

    <!-- Pending CIF -->
    <table class="table table-striped table-bordered text-center" *ngIf="activeType === 'I'">
      <thead class="column-css">

        <tr>
          <th>Customer Id</th>
          <th>Branch Id</th>
          <th>Full Name</th>
          <th>Decline Reason</th>
          <th>CIF Creation Date</th>
          <th>Updated By</th>
          <th>Error</th>


        </tr>
      </thead>
      <tbody *ngIf="tableData && tableData.length > 0">
        <tr *ngFor="let item of tableData; let i = index; trackBy: trackByFn">
          <td>{{ item.customerId || '-' }}</td>
          <td>{{ item.branchId || '-' }}</td>
          <td>{{ item.fullName || '-' }}</td>
          <td>{{ item.declinedReason || '-' }}</td>
          <td>{{ item.cifCreationDate || '-' }}</td>
          <td>{{ item.updatedBy || '-' }}</td>
          <td>{{ item.error || '-' }}</td>

        </tr>
      </tbody>
    </table>
    <!-- Table for failed CIF -->
    <table class="table table-striped table-bordered text-center" *ngIf="activeType === 'J'">
      <thead class="column-css">

        <tr>
          <th>Branch Id</th>
          <th>Customer Id</th>
          <th>Full Name</th>
          <th>Amend Date</th>
          <th>Error</th>

        </tr>
      </thead>
      <tbody *ngIf="tableData && tableData.length > 0">
        <tr *ngFor="let item of tableData; let i = index; trackBy: trackByFn">
          <td>{{ item.branchId || '-' }}</td>
          <td>{{ item.customerId || '-' }}</td>
          <td>{{ item.fullName || '-' }}</td>
          <td>{{ item.amendDate || '-' }}</td>
          <td>{{ item.error || '-' }}</td>

        </tr>
      </tbody>
    </table>



  </div>
  <!-- Pagination -->


</mat-card>

<div class="paginator-padding">
  <div class="paginator" *ngIf="totalCount >= pageSize">
    <mat-paginator [length]="totalCount" [pageSize]="pageSize" [pageIndex]="pageIndex"
      [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page" (page)="onPageChange($event)">
    </mat-paginator>
    <br>
    <br>
    <br>
    <br>
  </div>
</div>